  package expo.modules.kotlin

  import android.util.Log
  import expo.modules.kotlin.modules.Module

  class NPModulesProviderProxy: ModulesProvider{
    private val  moduleList = ArrayList<Class<out Module>>();

    override fun getModulesList(): List<Class<out Module>> {
      return  moduleList;
    }
    fun addModuleList(lst:List<Class<out Module>> ){
      moduleList.addAll(lst);
    }
    fun addModule(module:Class<out Module> ){
      moduleList.add(module);
    }
  }
  class ExpoModulesHelper {
    companion object {
      val modulesProvider by lazy {
        try {
          val newProvider = NPModulesProviderProxy();
          val expoModules = Class.forName("expo.modules.ExpoModulesPackageList")
          val old = expoModules.getConstructor().newInstance() as ModulesProvider
          newProvider.addModuleList(old.getModulesList())
          newProvider
        } catch (e: Exception) {
          Log.e("ExpoModulesHelper", "Couldn't get expo modules list.", e)
          null
        }
      }
    }
  }